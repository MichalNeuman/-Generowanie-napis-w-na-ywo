<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Transcription</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <link rel="stylesheet", href="../static/css/style.css">
</head>
<body>
<div id="page-wrapper">
    <h1>Transkrypcja na żywo</h1>
    <p><em>Tekst jest edytowalny. Zmiany zostaną zapisane automatycznie.</em></p>
    <div id="transcription-container">
        <div id="transcription-entries">
            <!-- Transkrypcja zostanie tutaj dodana -->
        </div>
    </div>
</div>



   <script>
    const socket = io(); // Connect to the WebSocket server
    const container = document.getElementById("transcription-entries");

    // Function to add a new line to the transcription
    function prependLine(newText) {
        const newLine = document.createElement("div");
        newLine.className = "line new"; // Add the `new` class for animation
        newLine.textContent = newText;
        newLine.contentEditable = "true"; // Allow editing
        container.prepend(newLine);

        // Remove the `new` class after the animation ends
        setTimeout(() => {
            newLine.classList.remove("new");
        }, 800);
    }

    // Update text on the server after an edit
    container.addEventListener("input", () => {
        const updatedText = Array.from(container.children)
            .map(line => line.textContent)
            .join("\n");
        socket.emit("update_text", { text: updatedText });
    });

    // Listen for 'transcription' event and add a new line
    socket.on("transcription", (data) => {
        console.log("New data received:", data.text);
        prependLine(data.text);
    });

    // Listen for 'task_update' event and update all entries
   socket.on("task_update", (data) => {
    console.log("Received task update:", data.text);
    container.innerHTML = ""; // Clear current entries
    data.text.split("\n").forEach(line => {
        if (line.trim()) prependLine(line); // Add each line
    });
});

    // Request initial transcription text when connected
    socket.emit("get_transcription");

    socket.on("connect", () => {
        console.log("Connected to WebSocket server!");
    });
</script>

</body>
</html>